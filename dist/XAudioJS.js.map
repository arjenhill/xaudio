{"version":3,"file":"XAudioJS.js","sources":["../src/index.js"],"sourcesContent":["class XAudioJS {\n  constructor() {\n    let audio;\n    let debug;\n    let _src;\n    let register = {};\n\n    // autoplay 属性优先于 preload 假如用户想自动播放音频，那么很明显浏览器需要下载音频。\n    // 同时设置autoplay 和 preload属性在规范里是允许的。\n    this.autoplay = false;\n    this.loop = false;\n    this.preload = 'auto';\n\n    this.debug = () => {\n      debug = true;\n      audio.style.position = 'absolute';\n      audio.style.zIndex = 9999;\n      audio.style.display = 'block';\n      audio.style.width = '250px';\n      audio.style.height = '30px';\n      audio.setAttribute('controls', true);\n      document.body.appendChild(audio);\n    };\n\n    this.init = (config) => {\n      this.loop = config.loop;\n      this.ready = config.ready;\n      this.canplay = config.canplay;\n      this.update = config.update;\n      this.loadedmetadata = config.loadedmetadata;\n\n      audio = createAudio(config);\n\n      if (config.src) {\n        let src = config.src;\n        _src = src;\n        audio.src = src;\n\n        try {\n          audio.load();\n        } catch (e) {}\n      }\n    };\n\n    this.play = (src, autoplay) => {\n      if (src !== undefined) {\n        this.playNew(src);\n      }\n      if (autoplay !== undefined) audio.setAttribute('autoplay', autoplay);\n\n      audio.play();\n    };\n\n    this.pause = () => {\n      if (audio.pause) audio.pause();\n    };\n\n    this.stop = () => {\n      // 音频播放还没有进入第一次 timeupdate 的时候设置currentTime 会报错\n      try {\n        audio.currentTime = 0;\n      } catch (e) {}\n\n      if (audio.pause) audio.pause();\n    };\n\n    this.setVolume = this.volume = (volume) => {\n      audio.volume = volume;\n    };\n\n    this.setCurrentTime = this.currentTime = (time = 0) => {\n      // return audio.currentTime * 1000;\n      if (time === 0) {\n        return audio.currentTime * 1000;\n      } else {\n        audio.currentTime();\n      }\n    };\n\n    this.getDuration = this.duration = () => {\n      return audio.duration * 1000;\n    };\n\n    this.getAudio = this.audio = () => {\n      return audio;\n    };\n\n    this.getSrc = () => {\n      return _src;\n    };\n\n    this.getStats = this.stats = () => {\n      return !audio.paused;\n    };\n\n    this.destroy = () => {\n      this.stop();\n      if (this.ready) {\n        register['ready'] = false;\n        audio.removeEventListener('canplaythrough', this.ready);\n      }\n\n      if (this.canplay) {\n        register['canplay'] = false;\n        audio.removeEventListener('canplay', this.canplay);\n      }\n\n      if (this.durationchange) {\n        register['durationchange'] = false;\n        audio.removeEventListener('durationchange', this.durationchange);\n      }\n\n      if (this.update) {\n        register['update'] = false;\n        audio.removeEventListener('update', this.update);\n      }\n\n      if (this.ended) {\n        register['ended'] = false;\n        audio.removeEventListener('ended', this.ended);\n      }\n\n      if (register['loadedmetadata']) {\n        register['loadedmetadata'] = false;\n        audio.removeEventListener('ended', this.ended);\n      }\n    };\n\n    //  新播放\n    this.playNew = (src) => {\n      if (debug) {\n        console.log(src);\n      }\n      addListener();\n\n      _src = src;\n      let reload = audio.src ? true : false;\n      audio.src = src;\n      try {\n        if (reload) audio.load();\n      } catch (e) {}\n    };\n\n    //  添加侦听\n    const addListener = () => {\n      if (this.ready && !register['ready']) {\n        register['ready'] = true;\n        audio.addEventListener('canplaythrough', this.ready, false);\n      }\n\n      if (this.canplay && !register['canplay']) {\n        register['canplay'] = true;\n        audio.addEventListener('canplay', this.canplay, false);\n      }\n\n      if (this.durationchange && !register['durationchange']) {\n        register['durationchange'] = true;\n        audio.addEventListener('durationchange', this.durationchange, false);\n      }\n\n      if (this.update && !register['update']) {\n        register['update'] = true;\n        audio.addEventListener('timeupdate', this.update, true);\n      }\n\n      if (!register['loadedmetadata']) {\n        register['loadedmetadata'] = true;\n        audio.addEventListener(\n          'loadedmetadata',\n          () => {\n            if (debug) {\n              console.log(audio.duration);\n            }\n\n            if (this.loadedmetadata) {\n              this.loadedmetadata();\n            }\n          },\n          false\n        );\n      }\n\n      if (this.ended && !register['ended']) {\n        register['ended'] = true;\n        audio.addEventListener('ended', this.ended, true);\n      }\n    };\n\n    //  创建标签\n    const createAudio = (config) => {\n      let audio = document.createElement('audio');\n      if (config && config.autoplay) audio.setAttribute('autoplay', 'true');\n      if (config && config.loop) audio.setAttribute('loop', 'true');\n      if (config && config.type) audio.setAttribute('type', config.type);\n      if (config) audio.setAttribute('preload', config.preload);\n\n      audio.style.position = 'absolute';\n      audio.style.zIndex = 999;\n      audio.style.top = '0px';\n      audio.style.left = '0px';\n      audio.style.width = '0px';\n      audio.style.height = '0px';\n      audio.style.display = 'none';\n\n      document.body.appendChild(audio);\n      return audio;\n    };\n  }\n}\n\nexport default XAudioJS;\n"],"names":["XAudioJS","constructor","audio","debug","_src","register","autoplay","loop","preload","style","position","zIndex","display","width","height","setAttribute","document","body","appendChild","init","config","ready","canplay","update","loadedmetadata","createAudio","src","load","e","play","undefined","playNew","pause","stop","currentTime","setVolume","volume","setCurrentTime","time","getDuration","duration","getAudio","getSrc","getStats","stats","paused","destroy","removeEventListener","durationchange","ended","console","log","addListener","reload","addEventListener","createElement","type","top","left"],"mappings":"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"}