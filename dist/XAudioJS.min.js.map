{"version":3,"file":"XAudioJS.min.js","sources":["../src/index.js"],"sourcesContent":["class XAudioJS {\n  constructor() {\n    let audio;\n    let debug;\n    let _src;\n    let register = {};\n\n    // autoplay 属性优先于 preload 假如用户想自动播放音频，那么很明显浏览器需要下载音频。\n    // 同时设置autoplay 和 preload属性在规范里是允许的。\n    this.autoplay = false;\n    this.loop = false;\n    this.preload = 'auto';\n\n    this.debug = () => {\n      debug = true;\n      audio.style.position = 'absolute';\n      audio.style.zIndex = 9999;\n      audio.style.display = 'block';\n      audio.style.width = '250px';\n      audio.style.height = '30px';\n      audio.setAttribute('controls', true);\n      document.body.appendChild(audio);\n    };\n\n    this.init = (config) => {\n      this.loop = config.loop;\n      this.ready = config.ready;\n      this.canplay = config.canplay;\n      this.update = config.update;\n      this.loadedmetadata = config.loadedmetadata;\n\n      audio = createAudio(config);\n\n      if (config.src) {\n        let src = config.src;\n        _src = src;\n        audio.src = src;\n\n        try {\n          audio.load();\n        } catch (e) {}\n      }\n    };\n\n    this.play = (src, autoplay) => {\n      if (src !== undefined) {\n        this.playNew(src);\n      }\n      if (autoplay !== undefined) audio.setAttribute('autoplay', autoplay);\n\n      audio.play();\n    };\n\n    this.pause = () => {\n      if (audio.pause) audio.pause();\n    };\n\n    this.stop = () => {\n      // 音频播放还没有进入第一次 timeupdate 的时候设置currentTime 会报错\n      try {\n        audio.currentTime = 0;\n      } catch (e) {}\n\n      if (audio.pause) audio.pause();\n    };\n\n    this.setVolume = this.volume = (volume) => {\n      audio.volume = volume;\n    };\n\n    this.setCurrentTime = this.currentTime = (time = 0) => {\n      // return audio.currentTime * 1000;\n      if (time === 0) {\n        return audio.currentTime * 1000;\n      } else {\n        audio.currentTime();\n      }\n    };\n\n    this.getDuration = this.duration = () => {\n      return audio.duration * 1000;\n    };\n\n    this.getAudio = this.audio = () => {\n      return audio;\n    };\n\n    this.getSrc = () => {\n      return _src;\n    };\n\n    this.getStats = this.stats = () => {\n      return !audio.paused;\n    };\n\n    this.destroy = () => {\n      this.stop();\n      if (this.ready) {\n        register['ready'] = false;\n        audio.removeEventListener('canplaythrough', this.ready);\n      }\n\n      if (this.canplay) {\n        register['canplay'] = false;\n        audio.removeEventListener('canplay', this.canplay);\n      }\n\n      if (this.durationchange) {\n        register['durationchange'] = false;\n        audio.removeEventListener('durationchange', this.durationchange);\n      }\n\n      if (this.update) {\n        register['update'] = false;\n        audio.removeEventListener('update', this.update);\n      }\n\n      if (this.ended) {\n        register['ended'] = false;\n        audio.removeEventListener('ended', this.ended);\n      }\n\n      if (register['loadedmetadata']) {\n        register['loadedmetadata'] = false;\n        audio.removeEventListener('ended', this.ended);\n      }\n    };\n\n    //  新播放\n    this.playNew = (src) => {\n      if (debug) {\n        console.log(src);\n      }\n      addListener();\n\n      _src = src;\n      let reload = audio.src ? true : false;\n      audio.src = src;\n      try {\n        if (reload) audio.load();\n      } catch (e) {}\n    };\n\n    //  添加侦听\n    const addListener = () => {\n      if (this.ready && !register['ready']) {\n        register['ready'] = true;\n        audio.addEventListener('canplaythrough', this.ready, false);\n      }\n\n      if (this.canplay && !register['canplay']) {\n        register['canplay'] = true;\n        audio.addEventListener('canplay', this.canplay, false);\n      }\n\n      if (this.durationchange && !register['durationchange']) {\n        register['durationchange'] = true;\n        audio.addEventListener('durationchange', this.durationchange, false);\n      }\n\n      if (this.update && !register['update']) {\n        register['update'] = true;\n        audio.addEventListener('timeupdate', this.update, true);\n      }\n\n      if (!register['loadedmetadata']) {\n        register['loadedmetadata'] = true;\n        audio.addEventListener(\n          'loadedmetadata',\n          () => {\n            if (debug) {\n              console.log(audio.duration);\n            }\n\n            if (this.loadedmetadata) {\n              this.loadedmetadata();\n            }\n          },\n          false\n        );\n      }\n\n      if (this.ended && !register['ended']) {\n        register['ended'] = true;\n        audio.addEventListener('ended', this.ended, true);\n      }\n    };\n\n    //  创建标签\n    const createAudio = (config) => {\n      let audio = document.createElement('audio');\n      if (config && config.autoplay) audio.setAttribute('autoplay', 'true');\n      if (config && config.loop) audio.setAttribute('loop', 'true');\n      if (config && config.type) audio.setAttribute('type', config.type);\n      if (config) audio.setAttribute('preload', config.preload);\n\n      audio.style.position = 'absolute';\n      audio.style.zIndex = 999;\n      audio.style.top = '0px';\n      audio.style.left = '0px';\n      audio.style.width = '0px';\n      audio.style.height = '0px';\n      audio.style.display = 'none';\n\n      document.body.appendChild(audio);\n      return audio;\n    };\n  }\n}\n\nexport default XAudioJS;\n"],"names":["constructor","audio","debug","_src","register","autoplay","loop","preload","style","position","zIndex","display","width","height","setAttribute","document","body","appendChild","init","config","ready","canplay","update","loadedmetadata","createAudio","src","load","e","play","undefined","playNew","pause","stop","currentTime","setVolume","this","volume","setCurrentTime","time","getDuration","duration","getAudio","getSrc","getStats","stats","paused","destroy","removeEventListener","durationchange","ended","console","log","addListener","reload","addEventListener","createElement","type","top","left"],"mappings":"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"}